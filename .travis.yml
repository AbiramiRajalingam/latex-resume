before_install:
 - sudo apt-get install ghostscript

install:
 - source ./support/texlive.sh

cache:
  directories:
    - /tmp/texlive
    - $HOME/.texlive

jobs:
  include:
    - if: NOT tag IS present
      script: l3build check -q -H --show-log-on-error
      name: "Test suite"
    - if: NOT tag IS present
      script: l3build doc -q -H --show-log-on-error
      name: "Documentation"
    - if: tag IS present
      script: l3build ctan -H --show-log-on-error
      name: "Full CTAN build"

notifications:
  email:
    recipients:
      - latex3-commits@tug.org
    on_success: change
    on_failure: always
    on_start:   never

deploy:
  - provider: releases
    api_key:
      secure: [to-do]
    file_glob: true
    file:
      - ./*.zip
    skip_cleanup: true
    on:
      tags: true
      condition: $TRAVIS_TAG == *-dev
    prerelease: true
  - provider: releases
    api_key:
      secure: [to-do]
    file_glob: true
    file:
      - ./*.zip
    skip_cleanup: true
    on:
      tags: true
      condition: $TRAVIS_TAG != *-dev
    prerelease: false