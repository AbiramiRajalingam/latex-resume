% \iffalse meta-comment
%
% Copyright 2019
% The LaTeX3 Project and any individual authors listed elsewhere
% in this file.
%
% This file is part of the LaTeX base system.
% -------------------------------------------
%
% It may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3c
% of this license or (at your option) any later version.
% The latest version of this license is in
%    https://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of LaTeX
% version 2008 or later.
%
% This file has the LPPL maintenance status "maintained".
%
% The list of all files belonging to the LaTeX base distribution is
% given in the file `manifest.txt'. See also `legal.txt' for additional
% information.
%
% The list of derived (unpacked) files belonging to the distribution
% and covered by LPPL is defined by the unpacking scripts (with
% extension .ins) which are part of the distribution.
%
% \fi
% Filename: ltnews30.tex
%
% This is issue 30 of LaTeX News.

\documentclass{ltnews}
\usepackage[T1]{fontenc}

\usepackage{lmodern,url,hologo}

\usepackage{csquotes}

\providecommand\acro[1]{\textsc{#1}}
\providecommand\meta[1]{$\langle$\textit{#1}$\rangle$}
\providecommand\option[1]{\texttt{#1}}
\providecommand\env[1]{\texttt{#1}}


\providecommand\XeTeX{\hologo{XeTeX}}
\providecommand\LuaTeX{\hologo{LuaTeX}}
\providecommand\pdfTeX{\hologo{pdfTeX}}
\providecommand\MiKTeX{\hologo{MiKTeX}}
\providecommand\CTAN{\textsc{ctan}}
\providecommand\TL{\TeX{}Live}

\providecommand\githubissue[2][]{\ifhmode\unskip\fi
     \quad\penalty500\strut\nobreak\hfill
     \mbox{\small\slshape(%
       \href{https://github.com/latex3/latex2e/issues/\getfirstgithubissue#2 \relax}%
          	    {github issue#1 #2}%
           )}%
     \par}

% simple solution right now (just link to the first issue if there are more)
\def\getfirstgithubissue#1 #2\relax{#1}

\providecommand\sxissue[1]{\ifhmode\unskip\fi
     \quad\penalty500\strut\nobreak\hfill
     \mbox{\small\slshape(\url{https://tex.stackexchange.com/#1})}\par}

\providecommand\gnatsissue[2]{\ifhmode\unskip\fi
     \quad\penalty500\strut\nobreak\hfill
     \mbox{\small\slshape(%
       \href{https://www.latex-project.org/cgi-bin/ltxbugs2html?pr=#1\%2F#2}%
          	    {gnats issue #1/#2}%
           )}%
     \par}

\let\cls\pkg
\providecommand\env[1]{\texttt{#1}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\iffalse % only for TUB production
\usepackage{graphicx}
\makeatletter
% Xe\TeX{} requires reflecting the first E, hence we complain if the
% graphics package is not present.  (For plain documents, this can be
% loaded via Eplain.)  Also, at Barbara's suggestion, if the current
% font is slanted, we rotate by 180 instead of reflecting so there is at
% least a chance to look ok.  (The magic values here seem more or less
% ok for \texttt{cmsl} and \texttt{cmti}.)
%
%    \begin{macrocode}
\def\tubreflect#1{%
  \@ifundefined{reflectbox}{%
    \TBerror{A graphics package must be loaded for \string\XeTeX}%
  }{%
    \ifdim \fontdimen1\font>0pt
      \raise 1.6ex \hbox{\kern.1em\rotatebox{180}{#1}}\kern-.1em
    \else
      \reflectbox{#1}%
    \fi
  }%
}
\def\tubhideheight#1{\setbox0=\hbox{#1}\ht0=0pt \dp0=0pt \box0 }
\def\XekernbeforeE{-.125em}
\def\XekernafterE{-.1667em}
\DeclareRobustCommand{\Xe}{\leavevmode
  \tubhideheight{\hbox{X%
    \setbox0=\hbox{\TeX}\setbox1=\hbox{E}%
    \ifdim \fontdimen1\font>0pt \def\XekernbeforeE{0em}\fi
    \lower\dp0\hbox{\raise\dp1\hbox{\kern\XekernbeforeE\tubreflect{E}}}%
    \kern\XekernafterE}}}
\def\XeTeX{\Xe\TeX}
\def\XeLaTeX{\Xe{\kern.11em \LaTeX}}
\fi
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\publicationmonth{Pre-release Version --- unfinished}
\publicationyear{2019}

\publicationissue{30}

\begin{document}

%\addtolength\textheight{4.2pc}   % only for TUB

\maketitle
\tableofcontents

\setlength\rightskip{0pt plus 3em}

\newpage

\section{Introduction}

This document is under construction \ldots


\section{\LaTeX\texttt{-dev} formats now available}


We know that many of you, especially developers and maintainers of
important packages, have a strong interest in a stable \LaTeX{}
environment.

In order to keep \LaTeX{} very stable for users whilst allowing for
further development to continue, we now have a development branch of
\LaTeX{} on GitHub containing development code for the upcoming
release. When this code is ready for wider consumption and testing, we
generate a pre-release of \LaTeX{} from this development branch and make
it available on \CTAN.

For users of the \TL{} and \MiKTeX{} distributions it is therefore now
straightforward to test their documents and code against the upcoming
\LaTeX{} release with ease, simply by selecting a different program name
(when using the command line) or by selecting a menu entry (after
setting it up, see below).

If you do this then the latest version of the \LaTeX{} development format
will be used to process your document, allowing you to test the
upcoming release with your own documents and packages. For example, if
you run
\begin{verbatim}
  pdflatex-dev myfile
\end{verbatim}
then you will be greeted on the screen with something like \texttt{LaTeX2e
  <2019-10-01> pre-release-2} (identifying the pre-release format)
instead of the normal \texttt{LaTeX2e <2018-12-01>}. In this
pre-release you will find the latest new features that we have
developed. 

\subsection{Our hopes}

We don’t expect everybody to start using the development formats to
participate in testing, but we hope that people with a strong interest
in a stable \LaTeX{} environment (especially developers and maintainers
of important packages) will use the new facilities and help us to
ensure that future public releases of \LaTeX{} do not (as has happened in
the past) require some immediate patches because of issues that were
not identified by our internal regression test suite or by other
testing that we do.

Any issue identified when using the development format should
preferably be logged as an issue on GitHub, following the procedure
outlined on our website at \url{https://www.latex-project.org/bugs/}
including the use of the \pkg{latexbug} package as described.

Our bug reporting process normally states that issues involving
third-party software are out of scope as we can’t correct external
packages, see~\cite{30:Mittelbach:TB39-1}. However, in the particular
case of the development format showing an incompatibility with a
third-party package, it is fine to open an issue with us (in addition,
please, to informing the maintainer of that package) so that we know
about the problem and can jointly work on resolving it.

\subsection{Details please \ldots}

More details and some background information about the concepts and
the process is available in an upcoming TUGboat article: \enquote{The
  \LaTeX{} release workflow and the \LaTeX{} dev
  formats}~\cite{devformat}.

\subsection{Setting up menu items}

While the command line call works out of the box if you have a recent
up-to-date \TL{} or \MiKTeX{} installation, the use within an integrated
editing environment doesn’t at this point in time (maybe the
developers of these editors will include it in the future). However,
it is normally fairly simple to enable it as most (or even all?) of
them provide simple ways to call your own setup. How this works in
detail depends very much on the environment you use, so we can’t give
much help here.

But as an example: to provide an additional menu entry for
\texttt{XeLaTeX-dev} on a MacBook all that was necessary was to copy
the file \texttt{XeLaTeX.engine} to XeLaTeX-dev.engine and change the
call from \texttt{xelatex} to \texttt{xelatex-dev} inside.




\section{Improving Unicode handling in \pdfTeX{}}

The perhaps most important improvement in this release is an even
better support for UTF-8 characters when using \pdfTeX{}.\footnote{The
  Japanese engines e-p\TeX{} and e-up\TeX{} can't use these features
  yet as they don't support the primitive \cs{ifincsname}. Work is
  under way to resolve this in the engines.}

In Unicode engines any Unicode character (that is not acting as a
command, i.e., is \enquote{active}) can be used as part of the
\cs{label}/\cs{ref} mechanism or can be displayed in a message or
written to a file. In 8-bit engines, however, this was severely
restricted, essentially you had to limit yourself to using
\acro{ascii} letters, digits and a few punctuation symbols.  With the
new release most of these restrictions have been removed and you now
can write labels such as
\begin{verbatim}
  \label{eq:größer}
\end{verbatim}
or use accented characters, etc.\ as part of a \cs{typeout} message.
The only requirement remaining is that only those UTF-8 characters
that are also available for typesetting can be used, i.e., only those
which which adequate font support is loaded. Otherwise you will get an
error message stating that a particular Unicode character is not set
up for use with \LaTeX{}.

What is not possible with an 8-bit engine such as \pdfTeX{} is to use
characters other than \acro{ascii} letters as part of a command
name. This is due to the fact that all other characters in such
engines are not single character tokens, but in fact consist of a
sequence of bytes and this is not supported in command names.

\section{Improving file name handling in \pdfTeX{}}

A related change is that file names used as part of \cs{input},
\cs{includegraphics}, etc.\ can now contain Unicode characters as well
as spaces. In this case even characters that can't be typeset because
of missing font support can be used.


\section{Improve the \env{filecontents} environment}

The \env{filecontents} environment now supports an optional argument
in which you can specify that it is allowed to \option{overwrite} an
already existing file, by default nothing is written if the file
exists anywhere in the search tree. An alternative name for this
option is \texttt{force}.  Even then the environment will refuse to write
to \cs{jobname}\texttt{.tex} to avoid clobbering its own input
file. However, if you use a different extension on your input file you
could still overwrite it (there is no way to test for that).

With the option \option{nosearch} only the current directory is
examined not the \TeX{} tree. This is useful if you want to write a
local copy of a standard system file.
Finally, \option{noheader} prevents writing a preamble to the file
(which is the same as using the star form of the environment.

The environment ins now allowed anywhere in the document which means
it provides everything (and more) of what the \pkg{filecontents}
package provided in the past.



\section{Making more user commands robust}

In the early days of \LaTeX{} many commands were fragile, i.e., they
needed \cs{protect} in front of them when used in places such as
section headings etc. With \LaTeXe{} already many were made robust,
but still a fairly huge number remained unnecessarily fragile.

In this release of \LaTeX{} we have now tackled most of the remaining
once, except for a few that for one or the other reasons need to
always expand (at least partially) or where it rather unlikely that
they are ever needed in a so-called \enquote{moving argument}.

Doing this for \cs{begin} and \cs{end} was rather tricky as the
standard mechanism with \cs{DeclareRobustCommand} doesn't work here,
at least not for \cs{end} as that needs to expand during typesetting
without generating a \cs{relax} (from the \cs{protect}. Such a token
would start a new row in table environments, such as \texttt{tabular}
etc. Furthermore some packages try to look into the definition of
\cs{end} by expanding it several times. Thus expansion with
\cs{expandafter} had to produce exactly the same result as before. But
in the end we overcame that hurdle too, so now environments are
automatically robust if used in places like headings or
\verb=\typeout= and so forth.

What hasn't been tackled yet is \pkg{amsmath}. As this package
redefines a number of basic math construct they become fragile again
once the package is loaded. This area will be addressed in a follow up
release.

\githubissue{123}



\section{Other changes to the \LaTeX{} kernel}


\subsection{Guard against \cs{unskip} at the start of a tabular cell}

If a \env{tabular} or \env{array} cell started with command that
issued an \cs{unskip} as its first action centering the column got
broken because the space on the left got removed. This got corrected
by adding a minuscule additional space after the stretching space that
could be safely removed in such a case without being noticeable.

This change was also applied in the \pkg{array} package.

\githubissue{102}


\subsection{Fixes to Unicode table data}

\texttt{U+012F} which is \enquote{i with ogonek} should produce an
\enquote{i} and not a\enquote{dotless i}. This has been corrected.

\githubissue{122}

The Unicode slots \texttt{27E8} and \texttt{27E9} have been mapped to
\cs{textlangle} and \cs{textrangle} which is the recommended mapping.

\githubissue{110}

When doing cut-and-paste from other documents f-ligatures might show
up as Unicode characters. In the past those got rejected.  We now
translate them back to individual characters so that they get
accepted. If supported by the font (which is normally the case) they
are then reconstructed as ligatures and thus come out as
desired. Otherwise they will come out as individual characters which
is fine too.

\githubissue{154}


\subsection{Improve \cs{InputIfFileExists}'s handling of file names}

In rare circumstances it was possible that \cs{InputIfFileExists}
would work incorrectly, e.g., a construction such as
\begin{verbatim}
\InputIfFileExists{foo}{\input{bar}}{}
\end{verbatim}
Would not load the files \texttt{foo.tex} and \texttt{bar.tex} but
would load \texttt{foo.tex} twice. This has been corrected.

\githubissue{109}


\subsection{Provide slightly improved reference interface}

The packages \pkg{fcnylab} and \pkg{varioref} provided a slightly
improved definition of \cs{refstepcounter} which allowed the internal
\cs{p@..} commands to receive the counter value as an argument instead
of just acting as a simple prefix. The way more complex reference
value formatting can be carried out.  The also defined the command
\cs{labelformat} to specify such formatting in an easy way.  For
example, \verb=\labelformat{equation}{eq.~(#1}}= would result in
references to equations would come out automatically as
\enquote{eq.~(5)} or similar. As this means a \cs{ref} command can't
any longer be used at a start of a sentence, the packages also
provided \cs{Ref} for such scenarios.

Both \cs{labelformat} and \cs{Ref} are now moved into the kernel so
that they are  available out of the box without the need to load
additional packages.




\subsection{Improve wording of a warning message}

\emph{write} The kernel now says \enquote{Trying to load \ldots}
instead of \enquote{Try loading \ldots} in one of its informal
messages to match style of similar messages.

\githubissue{107}


\subsection{Avoid \cs{DeclareErrorFont} side effects}

As a side effect of setting up the error font for NFSS that
declaration also change the current font back to 10pt size. In most
circumstances that doesn't matter, because that declaration was meant
to be used only during the early stages of a \LaTeX{} run.

However, I turned out that it was also used in other places
(incorrectly actually, e.g., inside some \texttt{.fd} files) and there
the size reset caused havoc in seemingly random places. The command
has now change to not produce such side effects.

\gnatsissue{latex}{4399}



\subsection{\pkg{nfssfont}: Generate a font table as the default action}

With the small file \texttt{nfssfont.tex} it is possible to produce
font tables and other font tests in the style set up by Don Knuth. As
in nearly all cases producing a font table is the desired action this
action has been made the default so that one can simply hit enter
instead of having to write \verb=\table\bye=.


\subsection{For developers: \pkg{trace} package support by the kernel}

The \pkg{trace} package implements the commands \cs{traceon}
and \cs{traceoff} that work similar to \cs{tracingall} but skip
certain code blocks that produce a lot of tracing output being of no
interest during debugging (for example loading a font).
Code blocks that should be hidden during tracing need
to be surrounded by the macros \cs{conditionally@traceoff}
and \cs{contionally@traceon}.

The \LaTeX{} kernel now provides dummy definitions for these two
commands so that package writers can use them in their packages
regardless of \pkg{trace} being loaded or not.



        
\section{Changes to packages in the \pkg{tools} category}

\subsection{\pkg{array}: Warn if primitive column specifiers are overwritten}

With \cs{newcolumntype} it is possible to define your own column
specifiers for a \texttt{tabular} preamble, it is also possible to
change existing ones. However, doing that for a primitive column
specifier, such a \texttt{c}, is seldom a good idea, since then its
functionality becomes unavailable.  Therefore the package was supposed
to warn the user in this case, but due to a missing \cs{expandafter}
in the code it never did---now it does.

\githubissue{148}


\subsection{\pkg{multicol}: Introduce \texttt{minrows} counter for balancing}

When there are only a few lines of text on a page at the end of a
\env{multicols} environment balancing them looks rather odd, e.g., if
you then end up with three columns each containing a single line. This
can now be controlled through the counter \texttt{minrows} (default is
1) which requires at least that many lines in the first column during
balancing. Thus, if you set it to \texttt{2} one would get a
distribution of \texttt{2+1+0} lines and if set it to three, the result
would have been \texttt{3+0+0} instead of the default \texttt{1+1+1}.

What is most appropriate really depends on the circumstances, but this
now gives you the tools to make local or global adjustments.


\subsection{\pkg{varioref}: better support for \pkg{cleveref}}

The \pkg{varioref} package has been internally updated to provide
better interfaces for packages such as \pkg{hyperref} and
\pkg{cleveref}.

It now has a new package option \option{nospace} that stops
\pkg{varioref} from meddling with space in front it its commands. The
original behavior was always somewhat problematical and it is
suggested that for new documents to always use this option (which
should really have been the default).

Also added was support for the Arabic language through the option
\option{arabic}.



        
\subsection{\pkg{xr}: Support citations to bibliographies in external documents}

The \pkg{xr} package can be used to reference labels in external
document, e.g., when a work is split over different documents that
need to be processed separately, but has \cs{ref} or \cs{pageref}
links between each other. With this update \cs{cite} commands and
their cousins can now also reference bibliographies in external
documents, a feature that was originally made available by the package
\pkg{xcite} by Enrico Gregorio.

Note that for technical reasons \pkg{xr} doesn't work with
\pkg{hyperref}. Use \pkg{xr-hyper} instead if you need the latter
package.


\section{Changes to packages in the \pkg{amsmath} category}

\subsection{\pkg{amsmath}: Introduce \texttt{overunderset} command}

The \pkg{amsmath} package always offer the commands \cs{overset} and
\cs{underset} to produce binary operators with something set above or
below. But sometimes one needs to put something on both side and that
required some gymnastics. With the newly added \cs{overunderset} this
is now easily possible.



\section{Documentation updates}

There are a number of smaller documentation updates in different files
found on the documentation page of the \LaTeX{} Project
website~\cite{30:site-doc}.

\subsection{High-lighting the standard NFSS codes for series}

The font selection scheme uses a number of standard codes for
\cs{fontseries} and \cs{fontshape} to ensure that different fonts are
comparable, e.g., that you get a \enquote{light} weight if you specify
\texttt{l} and \enquote{extra bold} when you write \texttt{eb},
etc. Over the years people came up with a number of other creative
short codes like \texttt{k}, \texttt{j}, \texttt{t} and others with
the result that changing a font family required different codes and
thus prevented user from easily mixing and matching different
families. The \emph{Font Selection Guide}~\cite{fntguide} has been
updated to strongly recommend that the standard codes should be used
when providing font support.

Some work has been undertaken to get back to a coherent scheme and
all the font families supported through the program \texttt{autoinst}
are now producing the standard codes again. 


\subsection{\LaTeX{} \texttt{base} and \texttt{doc} distribution reunited}
      
For a long time the \LaTeX{} distribution available from \CTAN{} was
split into several parts to allow them to be uploaded or downloaded
separately. As this is these days more confusing than helpful we have
recombined the base part with the documentation part (as both are
anyway always updated jointly. Thus the package \texttt{latex-doc}
is no longer separately available from \CTAN{} but contained in the
\texttt{latex-base} distribution.


\begin{thebibliography}{9}

\bibitem{30:Mittelbach:TB39-1} Frank Mittelbach:
  \emph{New rules for reporting bugs in the \LaTeX{} core software}.  
  In: TUGboat, 39\#1, 2018.
  \url{https://latex-project.org/publications/}

  
\bibitem{devformat} Frank Mittelbach:
  \emph{The
  \LaTeX{} release workflow and the \LaTeX{} dev formats}.  
  In: TUGboat, 40\#2, 2019.
  \url{https://latex-project.org/publications/}

\bibitem{fntguide} \LaTeX{} Project Team:
  \emph{\LaTeXe{} font selection}.\\  
  \url{https://latex-project.org/documentation/}

\bibitem{30:site-doc} 
  \emph{\LaTeX{} documentation on the \LaTeX{} Project Website}.\\  
  \url{https://latex-project.org/documentation/}

\bibitem{30:site-pub} 
  \emph{\LaTeX{} Project publications on the \LaTeX{} Project Website}.\\
  \url{https://latex-project.org/publications/}

\end{thebibliography}

\end{document}

