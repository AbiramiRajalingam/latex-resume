% \iffalse meta-comment
%
% Copyright 2019-2021
% The LaTeX Project and any individual authors listed elsewhere
% in this file.
%
% This file is part of the LaTeX base system.
% -------------------------------------------
%
% It may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3c
% of this license or (at your option) any later version.
% The latest version of this license is in
%    https://www.latex-project.org/lppl.txt
% and version 1.3c or later is part of all distributions of LaTeX
% version 2008 or later.
%
% This file has the LPPL maintenance status "maintained".
%
% The list of all files belonging to the LaTeX base distribution is
% given in the file `manifest.txt'. See also `legal.txt' for additional
% information.
%
% The list of derived (unpacked) files belonging to the distribution
% and covered by LPPL is defined by the unpacking scripts (with
% extension .ins) which are part of the distribution.
%
% \fi
% Filename: ltnews34.tex
%
% This is issue 34 of LaTeX News.

\NeedsTeXFormat{LaTeX2e}[2020-02-02]

\documentclass{ltnews}

%%CCC  Temporary definitions:
\providecommand\Dash {\unskip ---}



%% NOTE:  Chris' preferred hyphens!
%%\showhyphens{parameters}
\hyphenation{because parameters parameter}

\usepackage[T1]{fontenc}

\usepackage{lmodern,url,hologo}

\usepackage{csquotes}
\usepackage{multicol}

\providecommand\hook[1]{\texttt{#1}}

\providecommand\meta[1]{$\langle$\textrm{\itshape#1}$\rangle$}
\providecommand\option[1]{\texttt{#1}}
\providecommand\env[1]{\texttt{#1}}
\providecommand\Arg[1]{\texttt\{\meta{#1}\texttt\}}


\providecommand\eTeX{\hologo{eTeX}}
\providecommand\XeTeX{\hologo{XeTeX}}
\providecommand\LuaTeX{\hologo{LuaTeX}}
\providecommand\pdfTeX{\hologo{pdfTeX}}
\providecommand\MiKTeX{\hologo{MiKTeX}}
\providecommand\CTAN{\textsc{ctan}}
\providecommand\TL{\TeX\,Live}
\providecommand\githubissue[2][]{\ifhmode\unskip\fi
     \quad\penalty500\strut\nobreak\hfill
     \mbox{\small\slshape(%
       \href{https://github.com/latex3/latex2e/issues/\getfirstgithubissue#2 \relax}%
          	    {github issue#1 #2}%
           )}%
     \par\smallskip}

% simple solution right now (just link to the first issue if there are more)
\def\getfirstgithubissue#1 #2\relax{#1}

\providecommand\sxissue[1]{\ifhmode\unskip\fi
     \quad\penalty500\strut\nobreak\hfill
     \mbox{\small\slshape(\url{https://tex.stackexchange.com/#1})}\par}

\providecommand\gnatsissue[2]{\ifhmode\unskip\fi
     \quad\penalty500\strut\nobreak\hfill
     \mbox{\small\slshape(%
       \href{https://www.latex-project.org/cgi-bin/ltxbugs2html?pr=#1\%2F\getfirstgithubissue#2 \relax}%
          	    {gnats issue #1/#2}%
           )}%
     \par}

\let\cls\pkg
\providecommand\env[1]{\texttt{#1}}
\providecommand\acro[1]{\textsc{#1}}

\vbadness=1400  % accept slightly empty columns


\makeatletter
% maybe not the greatest design but normally we wouldn't have subsubsections
\renewcommand{\subsubsection}{%
   \@startsection      {subsubsection}{2}{0pt}{1.5ex \@plus 1ex \@minus .2ex}%
      {-1em}{\@subheadingfont\colonize}%
}
\providecommand\colonize[1]{#1:}
\makeatother

\let\finalvspace\vspace          % for document layout fixes



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\providecommand\tubcommand[1]{}
\tubcommand{\input{tubltmac}}

\publicationmonth{November}
\publicationyear{2021 --- Draft Version} 

\publicationissue{34}

\begin{document}

\tubcommand{\addtolength\textheight{4.2pc}}   % only for TUB

\maketitle
{\hyphenpenalty=10000 \spaceskip=3.33pt \hbadness=10000 \tableofcontents}

\setlength\rightskip{0pt plus 3em}


\medskip


\section{Introduction}

\emph{write}

\section{???}

\emph{write}




\section{Hook business}


\subsection{Providing \cs{ActivateGenericHook}}

The hook management system offers a number of generic hooks, i.e.,
hooks whose names contain a variable component, for example the name
of an environment. Predeclaring such hooks as not really feasible
which is why these hooks use a different mechanism: they are
implicitly available end spring into life the moment a package or the
user in the preamble adds cde to them using \cs{AddToHook}.  The
kernel offers such hooks for environments \texttt{env/...}, commands
\texttt{cmd/...}, and files, package or classes, \texttt{file/...},
\texttt{include/...}, \texttt{package/...}, and \texttt{class/...}.

It is possible to offer generic hooks in packages, e.g., if you have
hooks that depend on the current language and therefore need the
language name as part of the hook name and you don't know all possible
names beforehand.

If you want to offer your generic hooks you do this by using
\cs{UseHook} or \cs{UseOneTimeHook} in your (package) code, but
\emph{without declaring the hook} with \cs{NewHook}. Without any
further work a call to \cs{UseHook} with an undeclared hook name does
nothing. So as an additional setup step, it is necessary to explicitly
activate the generic hook with \cs{ActivateGenericHook}.\footnote{Note
  that in the previous release we offered \cs{ProvideHook} as a means
  to achieve this effect, but the name was badly chosen so we decided
  to deprecate it and now offer \cs{ActivateGenericHook} instead
  because that is what it is meant for.}

Assuming
that you don't know all the different hook names up front it will
remain the task of the users of your package to activate the hook
themselves before adding code to it. For example, Babel offers hooks
such as \texttt{babel/afterextras/\meta{language}} enabling the user
to add language specific declarations there. They can then write
\begin{verbatim}
\ActivateGenericHook{babel/afterextras/ngerman}
\AddToHook{babel/afterextras/ngerman}{\color{blue}}
\end{verbatim}
after which all German words would be colored in blue in the text.

Note that a generic hook produced in this way is always a normal hook.




\subsection{Clear extra hook code for next invocation}

There are a few use cases where it would be helpful if one can cancel
an earlier use of \cs{AddToHookNext}, for example, when a page is
discarded with \cs{DiscardShipoutBox} because only some pages of the
document are printed. For such situations the new command
\cs{ClearHookNext} is provided.
%
\githubissue{565}



\subsection{Class, package, and include hook improvements}

Classes, packages and include files can only be loaded once in a
\LaTeX{} document. For that reasons hooks that are specific to such
files have been made one-time hooks. Beside being more efficient this
supports the following important use case
\begin{verbatim}
\AddToHook{package/after/varioref}
  { ... apply my customizations if the package
      gets loaded (or was loaded already) ... }
\end{verbatim}
without the need to first test if the package was already loaded
before.
%
\githubissue{623}





\subsection{???}

%
\githubissue{000}






\section{New or improved commands}


\subsection{Added \cs{PackageNote} and \cs{ClassNote}}

\LaTeX{} offers \cs{PackageError} to signal errors that stop
processing, \cs{PackageWarning} that generates a warning message on the
terminal, but continues with the processing and also \cs{PackageInfo}
to provide some information that is only written to the \texttt{.log}
file. What hasn't existed up to now is a way to provide some
information on the terminal that is identifying itself as coming from
a specific package but which isn't claiming to be a warning. Thus,
packages that wanted to write to the terminal used \cs{PackageWarning}
even though the information wasn't really warning the user.  For this
we now have \cs{PackageNote} and \cs{PackageNoteNoLine}, that identify
themselves as \enquote{informational}, but still go to the terminal and
not only to the transcript.

Similar commands exist for classes and there we have added the missing
\cs{ClassNote} and \cs{ClassNoteNoLine} as well.
%
\githubissue{613}


\subsection{New implementation for \cs{counterwithin}}

New implementation for \cs{counterwithout} and \cs{counterwithin} with
an additional optional arg so it becomes a drop-in replacement for
amsmath \cs{numberwithin}.

\emph{write appropriate description}



\subsection{New default for \cs{tracinglostchars}}

In 2021 the \TeX{} engines got enhanced so that \cs{tracinglostchars}
is now also supporting the value \texttt{3}, turning missing
characters into errors and not just warnings. This change made us
realize that \LaTeX{} should use a better default for this parameter
(so far the warning was only written to the transcript file).
Using the now available \texttt{3} would really be the best, but for
compatibility reasons we only set it to \texttt{2} in the kernel.
However, we recommend adding \cs{tracinglostchars}\texttt{=3} to the
preamble of documents, because missing glyphs in the output are an
error and should therefore be properly looked at.







\subsection{???}

%
\githubissue{000}




\section{Code improvements}


\subsection{Additional Extended Latin characters predefined}
Some additional characters such as \'k (U+1E131) are now pre-defined and
will work without needing \verb|\DeclareUnicodeCharacter| declarations.
%
\githubissue{593}


\subsection{Pick up all arguments to \cs{contentsline}}

The \cs{contentsline} commands in the TOC file are always followed by
four arguments, the last one being empty by default and only used by
\pkg{hyperref}. The \cs{contentsline} command itself only used the
first three arguments and relied on the fourth being empty (and thus
doing no harm). But this assumption is not always correct, e.g., if
you use \pkg{hyperref} and then remove it from the preamble.

So now we pick up all four arguments and save the last one away, so
that it can be used by \pkg{hyperref}.
%
\githubissue{633}


\subsection{???}

%
\githubissue{000}





\section{Changes to packages in the \pkg{graphics} category}


\subsection{???}

%
\githubissue{000}



\section{Changes to packages in the \pkg{tools} category}

\subsection{\pkg{varioref}: Improve missing label handling}

If an undefined label is referenced, \pkg{varioref} makes a default
definition so that later processing finds the right structure (two
brace groups inside \cs{r@}\meta{label}) However, if \pkg{nameref} or
\pkg{hyperref} is loaded, the data structure changes to five
arguments, resulting in low-evel errors in some cases. The code has
been changed to avoid these errors.
%
\sxissue{603948}


\subsection{\pkg{array}: Cancel  \cs{mathsurround} for \env{tabular}}

A \env{tabular} environment is internally typeset as an \env{array}
environment with special settings and therefore in math mode. This
math group should not get any \cs{mathsuround} added as it isn't a
real formula because otherwise the spacing around the \env{tabular}
changes. This bug has been there forever (which means not many people
use \cs{mathsurround} or noticed the difference). Anyhow, this now got
fixed.
%
\githubissue{614}



\subsection{???}

%
\githubissue{000}


\section{Changes to packages in the \pkg{amsmath} category}

\subsection{???}

%
\githubissue{000}




\medskip

\begin{thebibliography}{9}

\fontsize{9.3}{11.3}\selectfont

\bibitem{34:blueprint} Frank Mittelbach and Chris Rowley:
  \emph{\LaTeX{} Tagged PDF \Dash A blueprint for a large project}.\\
  \url{https://latex-project.org/publications/indexbyyear/2020/}

\bibitem{34:source2e}
  \emph{\LaTeX{} documentation on the \LaTeX{} Project Website}.\\
  \url{https://latex-project.org/help/documentation/}

\bibitem{34:ltnews32} \LaTeX{} Project Team:
  \emph{\LaTeXe{} news 32}.\\
  \url{https://latex-project.org/news/latex2e-news/ltnews32.pdf}

\end{thebibliography}



\end{document}
