%%
%% This is file `ltpara.sty',
%% generated with the docstrip utility.
%%
%% The original source files were:
%%
%% ltpara.dtx  (with options: `package')
%% 
%% This is a generated file.
%% 
%% Copyright 2020-2021 Frank Mittelbach
%% 
%% This file was generated from file(s) of the LaTeX `ltpara Bundle'.
%% --------------------------------------------------------------------------
%% 
%% It may be distributed and/or modified under the
%% conditions of the LaTeX Project Public License, either version 1.3c
%% of this license or (at your option) any later version.
%% The latest version of this license is in
%%    http://www.latex-project.org/lppl.txt
%% and version 1.3c or later is part of all distributions of LaTeX
%% version 2005/12/01 or later.
%% 
%% This file may only be distributed together with a copy of the LaTeX
%% `ltpara Bundle'. You may however distribute the `ltpara Bundle'
%% without such generated files.
%% 
%% The newest sources can be found below
%% 
%%    https://github.com/FrankMittelbach/fmitex/
%% 
%% where one can also log issues in case there are any.
%% 
%% 
%% File: ltpara.dtx (C) Copyright 2020-2021 Frank Mittelbach

\ExplSyntaxOn

\hook_new_pair:nn{para/begin}{para/end}
\let \@kernel@before@para@begin \@empty
\let \@kernel@after@para@end    \@empty
\tex_everypar:D {
  \box_set_to_last:N \l_para_indent_box
  \cs_set_eq:NN \__para_handle_indent: \__para_add_indent_box:
  \@kernel@before@para@begin
  \hook_use:n {para/begin}
  \mode_if_horizontal:F { \ERROR }
  \__para_handle_indent:
  \the \everypar
}
\newtoks \everypar
\box_new:N \l_para_indent_box

\cs_new:Npn \__para_add_indent_box: {
  \box_use_drop:N \l_para_indent_box
}
\cs_new_eq:NN \__para_handle_indent: \__para_add_indent_box:
\cs_new:Npn \para_indent_discard: {
  \cs_set_eq:NN \__para_handle_indent: \prg_do_nothing:
}
\cs_set_eq:NN \IndentationBox \l_para_indent_box
\cs_set_eq:NN \DiscardIndentationBox \para_indent_discard:
\cs_new_protected:Npn \__para_end: {
  \if_mode_horizontal:
    \if_mode_inner: \else:
         \tex_unskip:D
         \hook_use:n{para/end}
         \@kernel@after@para@end
         \mode_if_horizontal:F { \ERROR }
         \ifnum\lastnodetype>0 \tex_hskip:D \c_zero_dim \fi
     \fi: \fi:
  \tex_par:D
}
\cs_set_eq:NN \par     \__para_end:
\cs_set_eq:NN \@@par   \__para_end:
\cs_set_eq:NN \endgraf \__para_end:
\ExplSyntaxOff

% we have to redo that one
\everypar{\@nodocument} %% To get an error if text appears before the

\long\def \@savemarbox #1#2{%
  \global\setbox #1%
    \color@vbox
      \vtop{%
        \hsize\marginparwidth
        \@parboxrestore
        \@marginparreset
        #2\par                    % <-- needed
        \@minipagefalse
        \outer@nobreak
        }%
    \color@endbox
}


%\let\color@begingroup\begingroup
%\def\color@endgroup{\endgraf\endgroup}
%\def\color@setgroup{\color@begingroup}       % \def\color@setgroup{\color@begingroup\set@color}
%\def\color@hbox{\hbox\bgroup\color@begingroup}
%\def\color@vbox{\vbox\bgroup\color@begingroup}
%\def\color@endbox{\color@endgroup\egroup}

\endinput
%%
%% End of file `ltpara.sty'.
